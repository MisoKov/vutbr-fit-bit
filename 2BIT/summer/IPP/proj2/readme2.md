Implementační dokumentace k 2. úloze do IPP 2019/2020
Jméno a příjmení: Michal Koval
Login: xkoval17
___
## 1 Interpret
The main file is `interpret.py` and other files with classes are located in modules file. The program was designed in object oriented way. The main function of script is `interpret()` which initializes other classes dedicated to solving the subproblems of interpretation and calls their methods to pass control to them. Function first initializes all classs objects and then calls `args.processArgs(inst, xml)` to parse and check arguments, after that `xml.parseXML()` to parse the input code. With `analyser.runAnalysis()` the code is lexically checked. Execution of instructions is launched with `inst.startExecution()` and the return value of this method is also return code of program when no error occured. Statistics are printed at the end with `stati.printResults()`. This function serves as the last catcher of all exceptions and handles them by printing the error message and terminating the program with error code. All the errors are specified in`errors.py` file.
### 1.1 Processing arguments
Class `Args` implemented in `args.py` file. Checks and proccesses arguments. Main method `processArgs(self, inst, xml)` calls other smaller methods. Checks the correct number of arguments. Checks the duplicity of arguments. Sets the stats file in `Stati` object. Checks the path to files. Prints help. Can raise `ErrorArgs` with error code `10` in case of invalid arguments or `ErrorInput` with error code `11` in case of unexisting or unaccessible input files. 
### 1.2 Parsing XML
Implemented as class `XMLReader` in `xmlReader.py` file. Main method `parseXML(self)` parses the code with help of `xml.etree.ElementTree` library. Also performs the syntax analysis of the code with method `runAllChecks(self)`. Converts the input XML code to the sorted internal representation. Raises `ErrorXMLFormat` with error code `31` in case of not well formed XML input. In case of syntax error raises `ErrorXMLStruc` with error code `32`.
### 1.3 Analysis
Class `Analysis` implemented in `analysis.py`. Main method is `runAnalysis(self)` which runs checks according to the currently checked instruction. The analysis is based on the knowledge of which opcodes require which parameters. So if we know first parameter should be `var` the lexicall check of variable is performed with the argument. Symbols are also checked for type and each type has method to lexically check the value of said type. Symbols are also converted to their type since until this point everything was string. Raises `ErrorXMLStruc` with error code `31` when lexicall error is detected.

### 1.4 Execution of instructions
Implemented in two parts. The memory handling and working with variables in `Frames` class implemented in `frames.py`. Provides methods that work with internal structure of frames and define or set the values of variables in frames. These methods are then called in `Instructions` class implemented in `instructions.py`. This class manages the execution of intructions themselves. The main loop is in method `startExecution(self)` which runs until the last instruction is performed or ends sooner if instruction `EXIT` is proccessed or in case of error. Each intruction has its own method that is called when instruction is read in main loop. Before the execution itself the code is scanned for `LABEL` instructons to save their order for later jumps and check the redefinition.
### 1.5 Extensions
-**STACK**: Implemented in class `Instructions` and also the `XMLReader` class was adjusted for syntax checking of stack instructions. Provides methods to execute instructions working with stack. When taking value from stack as argument for instruction, `symb2` is always the first value at top of the stack. All the instructions are comptatible with *FLOAT* extension and also provides methods to handle instructions `FLOAT2INTS` and `INT2FLOATS`.
-**STATI**: Implemented as class `Stati` in `stati.py` module. Program arguments needed for this extension are processed by `Args` class. Provides methods which are called in Instructions module while executing the code to track the statistics. Method `printResults(self)` is always called at the end of main script and prints the results if program arguments were set. Results are only printed when valid source code was entered. Raises `ErrorOutput` with error code `12` in case of not being able to open/create the file passes as `--stats=` option.
-**FLOAT**: Implemented mostly in `Instruction` class. All methods handling instructions requiring parameters were adjusted to be either compatible with type float or return `InvalidOperandType` error code `53`. Analysis module also performs the checks with float type.

___
## 2 Testing script
Implemented in file `test.php` but also requires `Errors.php` for error codes.
### 2.1 Processing arguments
Processing of arguments is handled by `Arguments` class. Checks the validity of parameters, that means duplicity, missing parameters when required, correct number of arguments and whether files passed as arguments exist. If arguments are valid sets the testing parameters. Prints help when only `--help` argument is passed.
### 2.2 Running tests
Implemented in `Testing` class. Manages the running of tests. Method `ErrorXMLStruc()` performs last checks for the mode of testing and start the scanning of test directory with method `scanDir($dir)`. If `--recursive` is set than this method calls itself recursively for each folder found in `$dir`. Test files ending with `.src` are checked for their other needed files for the test case with `filesCheck($srcname)` and the test is executed with one convenience method `runTest($testname, $dir)` which calls the appropriate testing method for the set mode. Tests are executed with command `exec` and the return codes are saved for comparison. When `parse-only` is set the XML is compared with `jexamxml` tool. When interpret is tested comparison of output is peformed with linux tool `diff`.
### 2.3 Printing results
Implemented in `Testing` class. Results are printed in HTML format that can be displayed in any web browser. The style is defined in `<head>` section since it is all printed to `STDOUT`. Results consist of short summary of testing which is followed by colorful table containng all the tests and folders that were found and run. Yellow cells contain the folder and in `Result` column is the count of how many passed from total from this folder. Green represent the successful test. Red represents failed because of different return code and dark red means failed because of different output.